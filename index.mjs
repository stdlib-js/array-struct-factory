// Copyright (c) 2025 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-struct-constructor-like@esm/index.mjs";import{isPrimitive as t}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@esm/index.mjs";import{isPrimitive as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-integer@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-arraybuffer@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-collection@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-object@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-prototype-of@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-iterator-symbol-support@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-property@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-assert-contains@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/symbol-iterator@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/array-buffer@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-getter@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-accessor-getter@esm/index.mjs";import{ndarray as c}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/dstructs-struct@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@esm/index.mjs";function v(e,t,r){var n,s,i,o,a,l,f,h,u,m,d,p;for(l={format:"layout"},f=r.length,h=r.get&&r.set?b("default"):g("default"),o=e.layout,m=e.byteLength,s=new y(t),i=0,p=0;p<f;p++){d=h(r,p);try{a=e.viewOf(d),u=!0}catch(t){try{d=new e(d)}catch(e){return null}a=e.viewOf(d),u=!1}if(u&&d.toString(l)!==o)return null;n=new y(a.buffer,a.byteOffset,a.byteLength),c(m,n,1,0,s,1,i),i+=m}return t}var E=l(),x="StructArray";function _(l){var _,T,L,O;if(s(l))O=j(l);else{if(!e(l))throw new TypeError(w("invalid argument. First argument must be either a struct constructor or struct schema. Value: `%s`.",l));O=l}function B(e,a,l){var f,h,m,y;if(f=arguments.length,!(this instanceof B))return 0===f?new B:1===f?new B(e):2===f?new B(e,a):new B(e,a,l);if(0===f)h=new p(0),m=0;else if(1===f)if(t(e))h=new p(e*_),m=e;else if(s(e)){if(m=e.length,null===(h=v(O,new p(m*_),e)))throw new TypeError(w("invalid argument. Each element of a provided input array must be a valid object or a struct instance having the same layout as elements in the desired output array."))}else if(n(e)){if(m=(h=e).byteLength/_,!r(m))throw new RangeError(w("nullE9",_,h.byteLength))}else{if(!o(e))throw new TypeError(w("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",e));if(!1===E)throw new TypeError(w("invalid argument. Environment lacks Symbol.iterator support. First argument must be a length, ArrayBuffer, typed array, or array-like object. Value: `%s`.",e));if(!i(e[d]))throw new TypeError(w("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",e));if(h=e[d](),!i(h.next))throw new TypeError(w("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",e));if(m=(y=function(e){var t,r;for(t=[];!(r=e.next()).done;)t.push(r.value);return t}(h)).length,null===(h=v(O,new p(m*_),y)))throw new TypeError(w("invalid argument. Each element of a provided input iterable must be either a valid object or a struct instance having the same layout as elements in the desired output array."))}else{if(!n(h=arguments[0]))throw new TypeError(w("null2B",e));if(!t(a))throw new TypeError(w("null3X",a));if(!r(a/_))throw new RangeError(w("invalid argument. Second argument must be a multiple of %u. Value: `%u`.",_,a));if(a>=h.byteLength)throw new RangeError(w("invalid argument. Second argument exceeds the bounds of the ArrayBuffer. Value: `%s`.",a));if(2===f){if(m=(h.byteLength-a)/_,!r(m))throw new RangeError(w("invalid argument. ArrayBuffer view byte length must be a multiple of %u. View byte length: `%u`.",_,h.byteLength-a))}else{if(!t(m=l))throw new TypeError(w("null2m",m));if(m*_>h.byteLength-a)throw new RangeError(w("null2G",m*_))}}return u(this,"_buffer",h),u(this,"_byteOffset",a||0),u(this,"_byteLength",m*_),u(this,"_length",m),this}return _=O.byteLength,T=O.layout,L=O.fields,u(B,"BYTES_PER_ELEMENT",_),u(B,"name",x),u(B,"struct",O),m(B.prototype,"buffer",(function(){return this._buffer})),m(B.prototype,"byteLength",(function(){return this._byteLength})),m(B.prototype,"byteOffset",(function(){return this._byteOffset})),u(B.prototype,"BYTES_PER_ELEMENT",B.BYTES_PER_ELEMENT),u(B.prototype,"get",(function(e){if(!R(this))throw new TypeError(w("invalid invocation. `this` is not a %s.",x));if(!t(e))throw new TypeError(w("null2K",e));if(!(e>=this._length))return new O(this._buffer,this._byteOffset+e*_,_)})),m(B.prototype,"length",(function(){return this._length})),u(B.prototype,"set",(function(e){var r,n,i,a,l,u,m,d,p,j,v,E,B,S;if(!R(this))throw new TypeError(w("invalid invocation. `this` is not a %s.",x));if(u=this._buffer,arguments.length>1){if(!t(l=arguments[1]))throw new TypeError(w("null2L",l))}else l=0;if(a={format:"layout"},p=O.byteLength,!s(e)||h(L,"length")){if(l>=this._length)throw new RangeError(w("null2M",l));if(!o(e))throw new TypeError(w("invalid argument. Must provide either a valid object or a struct instance. Value: `%s`.",e));if(e.toString(a)===T)return i=O.viewOf(e),n=new y(i.buffer,i.byteOffset,p),r=new y(u,this._byteOffset+l*_,p),void c(p,n,1,0,r,1,0);for(v=new O(u,this._byteOffset+l*_,p),B=0;B<L.length;B++)E=L[B],f(e,E)&&(v[E]=e[E])}else{if(l+(j=e.length)>this._length)throw new RangeError(w("null03"));if(d=(i=e).get&&i.set?b("default"):g("default"),S=this._byteOffset+l*_,i.buffer===u&&i.byteOffset<S&&i.byteOffset+i.byteLength>S){for(m=[],B=0;B<j;B++)m.push(d(e,B));i=m,d=g("default")}for(B=0;B<j;l++,B++)this.set(d(i,B),l)}})),u(B.prototype,"struct",O),B;function R(e){return"object"==typeof e&&null!==e&&(e.constructor.name===x||a(e,B.prototype))&&e.BYTES_PER_ELEMENT===_}}export{_ as default};
//# sourceMappingURL=index.mjs.map
