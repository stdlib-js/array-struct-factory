// Copyright (c) 2025 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.2.2-esm/index.mjs";import{isPrimitive as t}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-integer@v0.2.2-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-arraybuffer@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-collection@v0.2.2-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.2.2-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-object@v0.2.2-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-prototype-of@v0.2.2-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-iterator-symbol-support@v0.2.2-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-property@v0.2.2-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-assert-contains@v0.2.2-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.2.2-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/symbol-iterator@v0.2.2-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/array-buffer@v0.2.2-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.2.2-esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-getter@v0.2.2-esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-accessor-getter@v0.2.2-esm/index.mjs";import{ndarray as b}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@v0.2.1-esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/dstructs-struct@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.2-esm/index.mjs";import{isPrimitive as j}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.2.2-esm/index.mjs";function w(e,t,r){var n,s,i,o,a,l,f,h,u,m,d,v;for(l={format:"layout"},f=r.length,h=r.get&&r.set?g("default"):y("default"),o=e.layout,m=e.byteLength,s=new p(t),i=0,v=0;v<f;v++){d=h(r,v);try{a=e.viewOf(d),u=!0}catch(t){try{d=new e(d)}catch(e){return null}a=e.viewOf(d),u=!1}if(u&&d.toString(l)!==o)return null;n=new p(a.buffer,a.byteOffset,a.byteLength),b(m,n,1,0,s,1,i),i+=m}return t}var E=a(),x="StructArray";function _(a){var _,T,L,O,B;if(n(a))O=v(a);else{if(!(s(B=a)&&j(B.alignment)&&j(B.byteLength)&&s(B.byteLengthOf)&&s(B.byteOffsetOf)&&s(B.bufferOf)&&s(B.viewOf)))throw new TypeError(c("invalid argument. First argument must be either a struct constructor or struct schema. Value: `%s`.",a));O=a}function R(o,a,l){var f,u,p,y;if(f=arguments.length,!(this instanceof R))return 0===f?new R:1===f?new R(o):2===f?new R(o,a):new R(o,a,l);if(0===f)u=new d(0),p=0;else if(1===f)if(e(o))u=new d(o*_),p=o;else if(n(o)){if(p=o.length,null===(u=w(O,new d(p*_),o)))throw new TypeError(c("invalid argument. Each element of a provided input array must be a valid object or a struct instance having the same layout as elements in the desired output array."))}else if(r(o)){if(p=(u=o).byteLength/_,!t(p))throw new RangeError(c("nullE9",_,u.byteLength))}else{if(!i(o))throw new TypeError(c("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",o));if(!1===E)throw new TypeError(c("invalid argument. Environment lacks Symbol.iterator support. First argument must be a length, ArrayBuffer, typed array, or array-like object. Value: `%s`.",o));if(!s(o[m]))throw new TypeError(c("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",o));if(u=o[m](),!s(u.next))throw new TypeError(c("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",o));if(p=(y=function(e){var t,r;for(t=[];!(r=e.next()).done;)t.push(r.value);return t}(u)).length,null===(u=w(O,new d(p*_),y)))throw new TypeError(c("invalid argument. Each element of a provided input iterable must be either a valid object or a struct instance having the same layout as elements in the desired output array."))}else{if(!r(u=arguments[0]))throw new TypeError(c("null2B",o));if(!e(a))throw new TypeError(c("null3X",a));if(!t(a/_))throw new RangeError(c("invalid argument. Second argument must be a multiple of %u. Value: `%u`.",_,a));if(a>=u.byteLength)throw new RangeError(c("invalid argument. Second argument exceeds the bounds of the ArrayBuffer. Value: `%s`.",a));if(2===f){if(p=(u.byteLength-a)/_,!t(p))throw new RangeError(c("invalid argument. ArrayBuffer view byte length must be a multiple of %u. View byte length: `%u`.",_,u.byteLength-a))}else{if(!e(p=l))throw new TypeError(c("null2m",p));if(p*_>u.byteLength-a)throw new RangeError(c("null2G",p*_))}}return h(this,"_buffer",u),h(this,"_byteOffset",a||0),h(this,"_byteLength",p*_),h(this,"_length",p),this}return _=O.byteLength,T=O.layout,L=O.fields,h(R,"BYTES_PER_ELEMENT",_),h(R,"name",x),h(R,"struct",O),u(R.prototype,"buffer",(function(){return this._buffer})),u(R.prototype,"byteLength",(function(){return this._byteLength})),u(R.prototype,"byteOffset",(function(){return this._byteOffset})),h(R.prototype,"BYTES_PER_ELEMENT",R.BYTES_PER_ELEMENT),h(R.prototype,"get",(function(t){if(!S(this))throw new TypeError(c("invalid invocation. `this` is not a %s.",x));if(!e(t))throw new TypeError(c("null2K",t));if(!(t>=this._length))return new O(this._buffer,this._byteOffset+t*_,_)})),u(R.prototype,"length",(function(){return this._length})),h(R.prototype,"set",(function(t){var r,s,o,a,h,u,m,d,v,j,w,E,B,R;if(!S(this))throw new TypeError(c("invalid invocation. `this` is not a %s.",x));if(u=this._buffer,arguments.length>1){if(!e(h=arguments[1]))throw new TypeError(c("null2L",h))}else h=0;if(a={format:"layout"},v=O.byteLength,!n(t)||f(L,"length")){if(h>=this._length)throw new RangeError(c("null2M",h));if(!i(t))throw new TypeError(c("invalid argument. Must provide either a valid object or a struct instance. Value: `%s`.",t));if(t.toString(a)===T)return o=O.viewOf(t),s=new p(o.buffer,o.byteOffset,v),r=new p(u,this._byteOffset+h*_,v),void b(v,s,1,0,r,1,0);for(w=new O(u,this._byteOffset+h*_,v),B=0;B<L.length;B++)E=L[B],l(t,E)&&(w[E]=t[E])}else{if(h+(j=t.length)>this._length)throw new RangeError(c("null03"));if(d=(o=t).get&&o.set?g("default"):y("default"),R=this._byteOffset+h*_,o.buffer===u&&o.byteOffset<R&&o.byteOffset+o.byteLength>R){for(m=[],B=0;B<j;B++)m.push(d(t,B));o=m,d=y("default")}for(B=0;B<j;h++,B++)this.set(d(o,B),h)}})),h(R.prototype,"struct",O),R;function S(e){return"object"==typeof e&&null!==e&&(e.constructor.name===x||o(e,R.prototype))&&e.BYTES_PER_ELEMENT===_}}export{_ as default};
//# sourceMappingURL=index.mjs.map
