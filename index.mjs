// Copyright (c) 2025 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.2.2-esm/index.mjs";import{isPrimitive as t}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.2.2-esm/index.mjs";import{isPrimitive as r}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-integer@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-arraybuffer@v0.2.2-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-collection@v0.2.2-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.2.2-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-object@v0.2.2-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-prototype-of@v0.2.2-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-iterator-symbol-support@v0.2.2-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-property@v0.2.2-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-assert-contains@v0.2.2-esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.2.2-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/symbol-iterator@v0.2.2-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/array-buffer@v0.2.2-esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.2.2-esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-getter@v0.2.2-esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/array-base-accessor-getter@v0.2.2-esm/index.mjs";import{ndarray as v}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@v0.2.1-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/dstructs-struct@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.2-esm/index.mjs";function w(e,t,r){var n,s,i,o,a,l,f,h,u,m,d,p;for(l={format:"layout"},f=r.length,h=r.get&&r.set?b("default"):g("default"),o=e.layout,m=e.byteLength,s=new y(t),i=0,p=0;p<f;p++){d=h(r,p);try{a=e.viewOf(d),u=!0}catch(t){try{d=new e(d)}catch(e){return null}a=e.viewOf(d),u=!1}if(u&&d.toString(l)!==o)return null;n=new y(a.buffer,a.byteOffset,a.byteLength),v(m,n,1,0,s,1,i),i+=m}return t}var E=l(),x="StructArray";function _(l){var _,T,L,O,B;if(s(l))O=c(l);else{if(!(i(B=l)&&t(B.alignment)&&t(B.byteLength)&&i(B.byteLengthOf)&&i(B.byteOffsetOf)&&i(B.bufferOf)&&i(B.viewOf)))throw new TypeError(j("invalid argument. First argument must be either a struct constructor or struct schema. Value: `%s`.",O));O=l}function R(t,a,l){var f,h,m,y;if(f=arguments.length,!(this instanceof R))return 0===f?new R:1===f?new R(t):2===f?new R(t,a):new R(t,a,l);if(0===f)h=new p(0),m=0;else if(1===f)if(e(t))h=new p(t*_),m=t;else if(s(t)){if(m=t.length,null===(h=w(O,new p(m*_),t)))throw new TypeError(j("invalid argument. Each element of a provided input array must be a valid object or a struct instance having the same layout as elements in the desired output array."))}else if(n(t)){if(m=(h=t).byteLength/_,!r(m))throw new RangeError(j("nullE9",_,h.byteLength))}else{if(!o(t))throw new TypeError(j("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",t));if(!1===E)throw new TypeError(j("invalid argument. Environment lacks Symbol.iterator support. First argument must be a length, ArrayBuffer, typed array, or array-like object. Value: `%s`.",t));if(!i(t[d]))throw new TypeError(j("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",t));if(h=t[d](),!i(h.next))throw new TypeError(j("invalid argument. First argument must be a length, ArrayBuffer, typed array, array-like object, or an iterable. Value: `%s`.",t));if(m=(y=function(e){var t,r;for(t=[];!(r=e.next()).done;)t.push(r.value);return t}(h)).length,null===(h=w(O,new p(m*_),y)))throw new TypeError(j("invalid argument. Each element of a provided input iterable must be either a valid object or a struct instance having the same layout as elements in the desired output array."))}else{if(!n(h=arguments[0]))throw new TypeError(j("null2B",t));if(!e(a))throw new TypeError(j("null3X",a));if(!r(a/_))throw new RangeError(j("invalid argument. Second argument must be a multiple of %u. Value: `%u`.",_,a));if(a>=h.byteLength)throw new RangeError(j("invalid argument. Second argument exceeds the bounds of the ArrayBuffer. Value: `%s`.",a));if(2===f){if(m=(h.byteLength-a)/_,!r(m))throw new RangeError(j("invalid argument. ArrayBuffer view byte length must be a multiple of %u. View byte length: `%u`.",_,h.byteLength-a))}else{if(!e(m=l))throw new TypeError(j("null2m",m));if(m*_>h.byteLength-a)throw new RangeError(j("null2G",m*_))}}return u(this,"_buffer",h),u(this,"_byteOffset",a||0),u(this,"_byteLength",m*_),u(this,"_length",m),this}return _=O.byteLength,T=O.layout,L=O.fields,u(R,"BYTES_PER_ELEMENT",_),u(R,"name",x),u(R,"struct",O),m(R.prototype,"buffer",(function(){return this._buffer})),m(R.prototype,"byteLength",(function(){return this._byteLength})),m(R.prototype,"byteOffset",(function(){return this._byteOffset})),u(R.prototype,"BYTES_PER_ELEMENT",R.BYTES_PER_ELEMENT),u(R.prototype,"get",(function(t){if(!S(this))throw new TypeError(j("invalid invocation. `this` is not a %s.",x));if(!e(t))throw new TypeError(j("null2K",t));if(!(t>=this._length))return new O(this._buffer,this._byteOffset+t*_,_)})),m(R.prototype,"length",(function(){return this._length})),u(R.prototype,"set",(function(t){var r,n,i,a,l,u,m,d,p,c,w,E,B,R;if(!S(this))throw new TypeError(j("invalid invocation. `this` is not a %s.",x));if(u=this._buffer,arguments.length>1){if(!e(l=arguments[1]))throw new TypeError(j("null2L",l))}else l=0;if(a={format:"layout"},p=O.byteLength,!s(t)||h(L,"length")){if(l>=this._length)throw new RangeError(j("null2M",l));if(!o(t))throw new TypeError(j("invalid argument. Must provide either a valid object or a struct instance. Value: `%s`.",t));if(t.toString(a)===T)return i=O.viewOf(t),n=new y(i.buffer,i.byteOffset,p),r=new y(u,this._byteOffset+l*_,p),void v(p,n,1,0,r,1,0);for(w=new O(u,this._byteOffset+l*_,p),B=0;B<L.length;B++)E=L[B],f(t,E)&&(w[E]=t[E])}else{if(l+(c=t.length)>this._length)throw new RangeError(j("null03"));if(d=(i=t).get&&i.set?b("default"):g("default"),R=this._byteOffset+l*_,i.buffer===u&&i.byteOffset<R&&i.byteOffset+i.byteLength>R){for(m=[],B=0;B<c;B++)m.push(d(t,B));i=m,d=g("default")}for(B=0;B<c;l++,B++)this.set(d(i,B),l)}})),u(R.prototype,"struct",O),R;function S(e){return"object"==typeof e&&null!==e&&(e.constructor.name===x||a(e,R.prototype))&&e.BYTES_PER_ELEMENT===_}}export{_ as default};
//# sourceMappingURL=index.mjs.map
